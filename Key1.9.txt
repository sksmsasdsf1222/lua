-- 로블록스 서비스 가져오기
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local UIS = game:GetService("UserInputService")

-- 기본 크기 설정
local originalSize = UDim2.new(0, 500, 0, 300)
local minimizedSize = UDim2.new(0, 250, 0, 50)

-- 고정된 관리자 키와 사용자 키
local adminKey = "admins.100725"
local userKeys = {
    "users.525851", "users.525852", "users.525853",
    "users.525854", "users.525855", "users.525856",
    "users.525857"
}

-- 메인 프레임 생성
local function createMainFrame()
    local frame = Instance.new("Frame")
    frame.Size = originalSize
    frame.Position = UDim2.new(0.5, -250, 0.45, -150) -- Y 위치를 0.45로 수정하여 위로 올림
    frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    frame.BorderSizePixel = 0
    frame.Active = true
    frame.Draggable = true
    frame.Parent = playerGui:FindFirstChildOfClass("ScreenGui")

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = frame

    return frame
end

-- 상단 타이틀바 및 닫기 버튼 생성
local function createTitleBar(frame)
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    titleBar.Parent = frame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -70, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "[ KR ] Narlum Hub"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.Font = Enum.Font.SourceSansBold
    titleLabel.TextSize = 18
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar

    -- 디스코드 버튼 생성
    local discordButton = Instance.new("ImageButton")
    discordButton.Size = UDim2.new(0, 30, 0, 30)
    discordButton.Position = UDim2.new(1, -60, 0, 0)
    discordButton.BackgroundTransparency = 1
    discordButton.Image = "rbxassetid://11417942820" -- 디스코드 아이콘 이미지 ID
    discordButton.Parent = titleBar

    discordButton.MouseButton1Click:Connect(function()
        local url = "https://discord.gg/H88xeCUXKU"
        game:GetService("GuiService"):OpenBrowserWindow(url)
    end)

    -- 닫기 버튼 생성
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 18
    closeButton.Parent = titleBar

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = closeButton

    return titleBar, closeButton
end

-- 메시지 표시 창 생성
local function showCompletionMessage(isAdmin, parentFrame)
    local completionFrame = Instance.new("Frame")
    completionFrame.Size = UDim2.new(0.38, 0, 0.38, 0) -- 화면 크기의 38%로 조정
    completionFrame.Position = UDim2.new(0.31, 0, 0.31, 0) -- 화면 중앙에 배치
    completionFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    completionFrame.BorderSizePixel = 0
    completionFrame.Parent = parentFrame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = completionFrame

    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, -20, 0.8, 0)
    messageLabel.Position = UDim2.new(0, 10, 0, 10)
    messageLabel.BackgroundTransparency = 1
    messageLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    messageLabel.Font = Enum.Font.SourceSans
    messageLabel.TextSize = 24
    messageLabel.TextWrapped = true
    messageLabel.Text = isAdmin and 
        "등록 완료\n당신은 관리자입니다. 절대로 키를 공유하지 마세요." or
        "등록 완료\n당신은 유저입니다."

    messageLabel.Parent = completionFrame

    -- 닫기 버튼 생성
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 18
    closeButton.Parent = completionFrame

    local cornerButton = Instance.new("UICorner")
    cornerButton.CornerRadius = UDim.new(0, 8)
    cornerButton.Parent = closeButton

    closeButton.MouseButton1Click:Connect(function()
        completionFrame:Destroy()
        createFinalInfoFrame(parentFrame) -- 등록 완료 후 추가 정보를 보여줄 새 창 생성
    end)
end

-- 최종 정보 창 생성
local function createFinalInfoFrame(parentFrame)
    local finalFrame = Instance.new("Frame")
    finalFrame.Size = UDim2.new(0.38, 0, 0.38, 0) -- 화면 크기의 38%로 조정
    finalFrame.Position = UDim2.new(0.31, 0, 0.31, 0) -- 화면 중앙에 배치
    finalFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    finalFrame.BorderSizePixel = 0
    finalFrame.Parent = parentFrame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = finalFrame

    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, -20, 0.8, 0)
    messageLabel.Position = UDim2.new(0, 10, 0, 10)
    messageLabel.BackgroundTransparency = 1
    messageLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    messageLabel.Font = Enum.Font.SourceSans
    messageLabel.TextSize = 24
    messageLabel.TextWrapped = true
    messageLabel.Text = "등록이 완료되었습니다.\n추가적인 안내 사항이나 다음 단계를 확인하세요."

    messageLabel.Parent = finalFrame

    -- 닫기 버튼 생성
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.TextSize = 18
    closeButton.Parent = finalFrame

    local cornerButton = Instance.new("UICorner")
    cornerButton.CornerRadius = UDim.new(0, 8)
    cornerButton.Parent = closeButton

    closeButton.MouseButton1Click:Connect(function()
        finalFrame:Destroy()
    end)
end

-- 입력 섹션 생성
local function createInputSection(frame)
    local inputPrompt = Instance.new("TextBox")
    inputPrompt.Size = UDim2.new(0.8, 0, 0.1, 0)
    inputPrompt.Position = UDim2.new(0.1, 0, 0.25, 0)
    inputPrompt.PlaceholderText = "키를 입력하세요"
    inputPrompt.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    inputPrompt.BorderSizePixel = 0
    inputPrompt.TextColor3 = Color3.fromRGB(0, 0, 0)
    inputPrompt.Parent = frame

    local submitButton = Instance.new("TextButton")
    submitButton.Size = UDim2.new(0.8, 0, 0.1, 0)
    submitButton.Position = UDim2.new(0.1, 0, 0.4, 0)
    submitButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    submitButton.Text = "완료"
    submitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    submitButton.Font = Enum.Font.SourceSansBold
    submitButton.TextSize = 18
    submitButton.Parent = frame

    submitButton.MouseButton1Click:Connect(function()
        local inputKey = inputPrompt.Text
        if inputKey == adminKey then
            inputPrompt.Text = "" -- 입력창 비우기
            showCompletionMessage(true, frame)
        elseif table.find(userKeys, inputKey) then
            inputPrompt.Text = "" -- 입력창 비우기
            showCompletionMessage(false, frame)
        else
            -- 잘못된 키일 때의 처리
            local errorFrame = Instance.new("Frame")
            errorFrame.Size = UDim2.new(0.38, 0, 0.25, 0) -- 화면 크기의 38%로 조정
            errorFrame.Position = UDim2.new(0.31, 0, 0.35, 0) -- 화면 중앙에 배치
            errorFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            errorFrame.BorderSizePixel = 0
            errorFrame.Parent = frame

            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 15)
            corner.Parent = errorFrame

            local errorLabel = Instance.new("TextLabel")
            errorLabel.Size = UDim2.new(1, -20, 0.8, 0)
            errorLabel.Position = UDim2.new(0, 10, 0, 10)
            errorLabel.BackgroundTransparency = 1
            errorLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
            errorLabel.Font = Enum.Font.SourceSans
            errorLabel.TextSize = 24
            errorLabel.TextWrapped = true
            errorLabel.Text = "잘못된 키입니다."

            errorLabel.Parent = errorFrame

            -- 닫기 버튼 생성
            local closeButton = Instance.new("TextButton")
            closeButton.Size = UDim2.new(0, 30, 0, 30)
            closeButton.Position = UDim2.new(1, -35, 0, 0)
            closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
            closeButton.Text = "X"
            closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            closeButton.Font = Enum.Font.SourceSansBold
            closeButton.TextSize = 18
            closeButton.Parent = errorFrame

            local cornerButton = Instance.new("UICorner")
            cornerButton.CornerRadius = UDim.new(0, 8)
            cornerButton.Parent = closeButton

            closeButton.MouseButton1Click:Connect(function()
                errorFrame:Destroy()
            end)
        end
    end)
end

-- 프로그램 실행
local mainFrame = createMainFrame()
local titleBar, closeButton = createTitleBar(mainFrame)
createInputSection(mainFrame)

-- 닫기 버튼 클릭 시 메인 프레임 종료
closeButton.MouseButton1Click:Connect(function()
    mainFrame:Destroy()
end)